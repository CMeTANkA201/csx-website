<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>CSX — приватный сервер</title>
<meta name="color-scheme" content="dark light" />
<style>
  :root{
    --bg:#0b0b0c; --fg:#ffffff; --muted:#bfbfbf;
    --glass-bg:rgba(255,255,255,0.06); --glass-stroke:rgba(255,255,255,0.18);
    --shadow:0 10px 30px rgba(0,0,0,0.45); --radius:18px; --blur:14px; --accent:#fff;
    --safe-area-bottom: env(safe-area-inset-bottom, 0px);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;background:var(--bg);color:var(--fg);-webkit-font-smoothing:antialiased;line-height:1.45;overflow-x:hidden}

  #bg{position:fixed;inset:0;z-index:-1;background:radial-gradient(1200px 800px at 20% 10%,#111 0%,#0b0b0c 45%,#060607 100%)}
  canvas.dust{position:fixed;inset:0;z-index:-1;pointer-events:none;opacity:.55;mix-blend-mode:screen}

  header{position:sticky;top:0;z-index:10;backdrop-filter:blur(var(--blur));background:linear-gradient(to bottom,rgba(10,10,12,.7),rgba(10,10,12,.35));border-bottom:1px solid rgba(255,255,255,.08)}
  .container{max-width:1100px;margin:0 auto;padding:16px 18px}
  .brand{display:flex;align-items:center;gap:12px;letter-spacing:.3px;font-weight:700;font-size:1.05rem;text-transform:uppercase}
  .brand .dot{width:10px;height:10px;border-radius:50%;background:var(--accent);box-shadow:0 0 18px rgba(255,255,255,.45)}

  nav.top{margin-top:12px;display:flex;gap:10px}
  .tab-btn{appearance:none;border:1px solid var(--glass-stroke);color:var(--fg);background:var(--glass-bg);backdrop-filter:blur(var(--blur));padding:10px 14px;border-radius:var(--radius);display:flex;align-items:center;gap:10px;box-shadow:var(--shadow);cursor:pointer;transition:.2s transform,.2s background,.2s border-color,.2s opacity;opacity:.95}
  .tab-btn[aria-selected="true"]{border-color:rgba(255,255,255,.35);background:rgba(255,255,255,.10)}
  .tab-btn:hover{transform:translateY(-1px)}
  .tab-btn svg{width:18px;height:18px;fill:none;stroke:currentColor;stroke-width:2}

  main{padding:28px 18px 110px}
  .panel{border:1px solid var(--glass-stroke);background:var(--glass-bg);backdrop-filter:blur(var(--blur));border-radius:calc(var(--radius) + 4px);box-shadow:var(--shadow);padding:20px}
  h1{font-size:1.6rem;margin:0 0 8px}
  p.lead{color:var(--muted);margin:0 0 18px}

  .cta-wrap{display:flex;flex-wrap:wrap;gap:12px;margin:14px 0 4px}
  .btn{display:inline-flex;align-items:center;gap:10px;padding:12px 16px;border-radius:14px;text-decoration:none;color:#000;background:#fff;font-weight:700;border:1px solid rgba(255,255,255,.45);transition:.2s transform,.2s opacity,.2s box-shadow;box-shadow:0 6px 24px rgba(255,255,255,0.12)}
  .btn:active{transform:translateY(1px)}
  .btn.monochrome{background:#111;color:#fff;border-color:rgba(255,255,255,.25)}
  .btn svg{width:18px;height:18px;stroke:currentColor;stroke-width:2;fill:none}

  .gallery{margin-top:18px}
  .grid{display:grid;gap:12px;grid-template-columns:repeat(3,minmax(0,1fr))}
  .grid .shot{position:relative;overflow:hidden;border-radius:16px;border:1px solid rgba(255,255,255,.14);background:#0f0f10}
  /* фикс невидимости: в сетке — height:auto */
  .grid .shot img{width:100%;height:auto;display:block;filter:contrast(1.02) saturate(.9)}

  .carousel{position:relative;overflow:hidden;border-radius:18px;border:1px solid rgba(255,255,255,.14)}
  .track{display:flex;transition:transform .35s ease;will-change:transform;touch-action:pan-y}
  .slide{min-width:100%;padding:8px;display:flex}
  .slide .shot{position:relative;overflow:hidden;border-radius:16px;border:1px solid rgba(255,255,255,.14);background:#0f0f10;width:100%}
  .slide .shot img{width:100%;height:100%;object-fit:cover;display:block}

  .arrow{position:absolute;top:50%;transform:translateY(-50%);width:42px;height:42px;border-radius:50%;display:grid;place-items:center;cursor:pointer;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.25);backdrop-filter:blur(var(--blur));transition:.2s opacity,.2s transform}
  .arrow:hover{transform:translateY(-50%) scale(1.04)}
  .arrow[disabled]{opacity:.35;pointer-events:none}
  .arrow.left{left:8px}.arrow.right{right:8px}
  .arrow svg{width:18px;height:18px;stroke:#fff}

  footer{color:var(--muted);padding:18px;text-align:center;border-top:1px solid rgba(255,255,255,.08);backdrop-filter:blur(var(--blur));background:linear-gradient(to top,rgba(10,10,12,.6),rgba(10,10,12,.28))}

  nav.bottom{position:fixed;bottom:0;left:0;right:0;z-index:12;display:none;padding:10px 12px calc(10px + var(--safe-area-bottom));backdrop-filter:blur(var(--blur));background:rgba(10,10,12,.5);border-top:1px solid rgba(255,255,255,.1)}
  .bottom .tab-btn{flex:1;justify-content:center;padding:10px 12px;font-size:.9rem}
  .bottom .tab-btn span{display:none}

  @media (max-width:820px){
    header .container{padding-bottom:10px}
    nav.top{display:none}
    nav.bottom{display:flex;gap:10px}
    main{padding:16px 12px 100px}
    .grid{grid-template-columns:repeat(2,minmax(0,1fr))}
    .btn{width:100%;justify-content:center}
    h1{font-size:1.35rem}
  }
  @media (max-width:460px){ .grid{grid-template-columns:1fr} }

  .visually-hidden{position:absolute!important;width:1px;height:1px;margin:-1px;padding:0;overflow:hidden;clip:rect(0 0 0 0);border:0}
</style>
</head>
<body>
<div id="bg" aria-hidden="true"></div>
<canvas class="dust" id="dust" aria-hidden="true"></canvas>

<header role="banner">
  <div class="container">
    <div class="brand" aria-label="CSX приватный сервер">
      <span class="dot" aria-hidden="true"></span><span>CSX — приватный сервер</span>
    </div>
    <nav class="top" aria-label="Главная навигация (ПК/планшет)" role="tablist">
      <button class="tab-btn" role="tab" aria-selected="true" aria-controls="tab-home" data-tab="home">
        <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M3 9.5l9-7 9 7"/><path d="M9 22V12h6v10"/><path d="M3 10v11h6"/><path d="M21 10v11h-6"/></svg><span>Главная</span>
      </button>
      <button class="tab-btn" role="tab" aria-selected="false" aria-controls="tab-download" data-tab="download">
        <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 3v12"/><path d="M7 10l5 5 5-5"/><path d="M5 21h14"/></svg><span>Скачать CSX</span>
      </button>
      <button class="tab-btn" role="tab" aria-selected="false" aria-controls="tab-tg" data-tab="tg">
        <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M22 3L2 11l6 2 2 6 4-4 4 3 4-15z"/><path d="M8 13l4 3"/></svg><span>Телеграмм разработчика</span>
      </button>
    </nav>
  </div>
</header>

<nav class="bottom" aria-label="Главная навигация (мобильная)" role="tablist">
  <button class="tab-btn" role="tab" aria-selected="true" aria-controls="tab-home" data-tab="home" aria-label="Главная">
    <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M3 9.5l9-7 9 7"/><path d="M9 22V12h6v10"/><path d="M3 10v11h6"/><path d="M21 10v11h-6"/></svg><span>Главная</span>
  </button>
  <button class="tab-btn" role="tab" aria-selected="false" aria-controls="tab-download" data-tab="download" aria-label="Скачать CSX">
    <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 3v12"/><path d="M7 10l5 5 5-5"/><path d="M5 21h14"/></svg><span>Скачать</span>
  </button>
  <button class="tab-btn" role="tab" aria-selected="false" aria-controls="tab-tg" data-tab="tg" aria-label="Телеграмм">
    <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M22 3L2 11l6 2 2 6 4-4 4 3 4-15z"/><path d="M8 13l4 3"/></svg><span>Telegram</span>
  </button>
</nav>

<main id="main" class="container" role="main">
  <section id="tab-home" class="panel tab" role="tabpanel" aria-labelledby="Главная">
    <h1>CSX — приватный сервер</h1>
    <p class="lead">Чёрно-белый iOS-стайл со стеклом. Ниже — скриншоты проекта.</p>
    <div class="cta-wrap" role="group" aria-label="Быстрые действия">
      <button class="btn" id="download-apk">
        <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 3v12"/><path d="M7 10l5 5 5-5"/><path d="M5 21h14"/></svg>
        <span>Скачать APK</span>
      </button>
      <a class="btn monochrome" id="to-download" href="#download" aria-label="Перейти на вкладку Скачать CSX">
        <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M4 12h16"/><path d="M12 4v16"/></svg>
        <span>К странице загрузки</span>
      </a>
    </div>
    <div class="gallery" id="gallery-home" aria-live="polite" aria-busy="true"></div>
  </section>

  <section id="tab-download" class="panel tab" hidden role="tabpanel" aria-labelledby="Скачать CSX">
    <h1>Скачать CSX</h1>
    <p class="lead">Файл загружается с Google Drive без перехода со страницы.</p>
    <div class="cta-wrap">
      <button class="btn" id="download-apk-2" aria-label="Скачать APK CSX">
        <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 3v12"/><path d="M7 10l5 5 5-5"/><path d="M5 21h14"/></svg>
        <span>Скачать CSX.apk</span>
      </button>
    </div>
    <div class="gallery" id="gallery-download" aria-live="polite" aria-busy="true"></div>
  </section>

  <section id="tab-tg" class="panel tab" hidden role="tabpanel" aria-labelledby="Телеграмм разработчика">
    <h1>Телеграмм разработчика</h1>
    <p class="lead">Связаться напрямую в Telegram.</p>
    <div class="cta-wrap">
      <a class="btn" href="tg://resolve?domain=Standoff_CSX" aria-label="Открыть Telegram по протоколу tg">
        <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M22 3L2 11l6 2 2 6 4-4 4 3 4-15z"/><path d="M8 13l4 3"/></svg>
        <span>Открыть в Telegram</span>
      </a>
      <a class="btn monochrome" href="https://t.me/Standoff_CSX" target="_blank" rel="noopener"
         aria-label="Открыть профиль Telegram в браузере">
        <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M22 3L2 11l6 2 2 6 4-4 4 3 4-15z"/><path d="M8 13l4 3"/></svg>
        <span>t.me/Standoff_CSX</span>
      </a>
    </div>
  </section>
</main>

<footer role="contentinfo">
  <small>© <span id="year"></span> CSX. Чёрно-белый стеклянный интерфейс.</small>
</footer>

<script>
/* Year */
document.getElementById('year').textContent = new Date().getFullYear();

/* Tabs */
const tabs = ["home","download","tg"];
const tabPanels = Object.fromEntries(tabs.map(id=>[id,document.getElementById('tab-'+id)]));
function setTab(id){
  tabs.forEach(t=>{
    const sel = (t===id);
    tabPanels[t].hidden = !sel;
    document.querySelectorAll(`[data-tab="${t}"]`).forEach(b=>b.setAttribute('aria-selected', String(sel)));
  });
  history.replaceState(null,"",`#${id}`);
}
document.querySelectorAll('[data-tab]').forEach(b=>b.addEventListener('click',()=>setTab(b.dataset.tab)));
(document.getElementById('to-download')||{}).addEventListener?.('click',(e)=>{e.preventDefault();setTab('download');scrollTo({top:0,behavior:'smooth'})});
setTab((location.hash||'#home').replace('#',''));

/* Sand dust background */
(function(){
  const c=document.getElementById('dust'),x=c.getContext('2d');
  let w=c.width=innerWidth,h=c.height=innerHeight;
  const count=Math.min(220,Math.floor((w*h)/18000));
  const p=[...Array(count)].map(()=>({x:Math.random()*w,y:Math.random()*h,vx:(Math.random()*2-1)*.15,vy:(Math.random()*2-1)*.15,r:Math.random()*1.4+.4,a:Math.random()*.35+.05}));
  addEventListener('resize',()=>{w=c.width=innerWidth;h=c.height=innerHeight},{passive:true});
  (function t(){x.clearRect(0,0,w,h);x.globalCompositeOperation='lighter';
    for(const s of p){s.x+=s.vx;s.y+=s.vy;if(s.x<-10)s.x=w+10;if(s.x>w+10)s.x=-10;if(s.y<-10)s.y=h+10;if(s.y>h+10)s.y=-10;
      x.beginPath();x.arc(s.x,s.y,s.r,0,Math.PI*2);x.fillStyle=`rgba(255,255,255,${s.a})`;x.fill();}
    requestAnimationFrame(t)})();
})();

/* Gallery loader: supports lower/UPPER case & leading zeros */
async function loadScreenshots({maxIndex=200, missStreakLimit=12, basePath='image'} = {}){
  const exts = ['png','jpg','jpeg','webp','PNG','JPG','JPEG','WEBP'];
  const indicesFor = (i)=>[`${i}`, i<10?`0${i}`:null].filter(Boolean); // 1 and 01
  const results=[]; let missStreak=0;

  async function tryNames(names){
    for(const name of names){
      for(const ext of exts){
        const ok = await probe(`./${basePath}/${name}.${ext}`);
        if(ok) return ok;
      }
    }
    return null;
  }
  function probe(src){
    return new Promise(res=>{
      const img=new Image();
      img.decoding='async'; img.loading='lazy'; img.alt='скрин';
      img.onload=()=>res({src});
      img.onerror=()=>res(null);
      img.src=src;
    });
  }

  for(let i=1;i<=maxIndex;i++){
    const found = await tryNames(indicesFor(i));
    if(found){ results.push(found); missStreak=0; }
    else if(++missStreak>=missStreakLimit) break;
  }
  return results;
}

function renderGrid(container, items){
  container.innerHTML='';
  const grid=document.createElement('div'); grid.className='grid';
  items.forEach((it, idx)=>{
    const fig=document.createElement('figure'); fig.className='shot';
    const img=document.createElement('img'); img.src=it.src; img.alt=`Скриншот ${idx+1}`; img.loading='lazy'; img.decoding='async';
    fig.appendChild(img);
    const cap=document.createElement('figcaption'); cap.className='visually-hidden'; cap.textContent=`Скриншот ${idx+1}`;
    fig.appendChild(cap); grid.appendChild(fig);
  });
  container.appendChild(grid); container.setAttribute('aria-busy','false');
}

function renderCarousel(container, items){
  container.innerHTML='';
  const car=document.createElement('div'); car.className='carousel'; car.setAttribute('role','region'); car.setAttribute('aria-label','Галерея (карусель)');
  const track=document.createElement('div'); track.className='track'; car.appendChild(track);
  items.forEach((it,idx)=>{
    const slide=document.createElement('div'); slide.className='slide'; slide.setAttribute('role','group'); slide.setAttribute('aria-roledescription','slide'); slide.setAttribute('aria-label',`${idx+1} из ${items.length}`);
    const fig=document.createElement('figure'); fig.className='shot';
    const img=document.createElement('img'); img.src=it.src; img.alt=`Скриншот ${idx+1}`;
    fig.appendChild(img); slide.appendChild(fig); track.appendChild(slide);
  });
  const left=document.createElement('button'); left.className='arrow left'; left.setAttribute('aria-label','Предыдущий'); left.innerHTML=`<svg viewBox="0 0 24 24"><path d="M15 18l-6-6 6-6"/></svg>`;
  const right=document.createElement('button'); right.className='arrow right'; right.setAttribute('aria-label','Следующий'); right.innerHTML=`<svg viewBox="0 0 24 24"><path d="M9 6l6 6-6 6"/></svg>`;
  car.appendChild(left); car.appendChild(right);
  let idx=0; const update=()=>{track.style.transform=`translateX(${-idx*100}%)`; left.toggleAttribute('disabled',idx<=0); right.toggleAttribute('disabled',idx>=items.length-1)};
  left.onclick=()=>{if(idx>0){idx--;update()}}; right.onclick=()=>{if(idx<items.length-1){idx++;update()}};
  let sx=0,cx=0,drag=false; const thr=40;
  track.addEventListener('touchstart',e=>{drag=true;sx=e.touches[0].clientX;cx=sx},{passive:true});
  track.addEventListener('touchmove',e=>{if(drag)cx=e.touches[0].clientX},{passive:true});
  track.addEventListener('touchend',()=>{if(!drag)return; const dx=cx-sx; if(Math.abs(dx)>thr){ if(dx<0&&idx<items.length-1)idx++; if(dx>0&&idx>0)idx--; } update(); drag=false});
  container.appendChild(car); container.setAttribute('aria-busy','false'); update();
}

(async function bootGalleries(){
  const imgs=await loadScreenshots();
  const mount=(el)=> imgs.length<=6 ? renderGrid(el,imgs) : renderCarousel(el,imgs);
  const home=document.getElementById('gallery-home'); const down=document.getElementById('gallery-download');
  mount(home); mount(down);
  if(imgs.length===0){
    [home,down].forEach(el=>{el.setAttribute('aria-busy','false'); el.innerHTML=`<div class="panel" role="note" style="margin-top:8px">Скриншоты не найдены. Добавьте файлы <code>/image/1.png</code>, <code>2.jpg</code>, … (поддерживаются PNG/JPG/JPEG/WEBP, включая <code>01.png</code>).</div>`;});
  }
})();

/* APK download: Google Drive without leaving page */
const DRIVE_ID = "12yTLnCPvpUk8-u2buWpQw-Sknqdjb-z_";
const DRIVE_URL = `https://drive.google.com/uc?export=download&id=${DRIVE_ID}`;

async function downloadViaFetchOrIframe(filename="CSX.apk"){
  try{
    const res = await fetch(DRIVE_URL, {credentials:"omit"});
    const ctype = res.headers.get('content-type')||'';
    // If we really got the file
    if(res.ok && !ctype.includes('text/html')){
      const blob = await res.blob();
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = filename;
      document.body.appendChild(a); a.click(); a.remove();
      setTimeout(()=>URL.revokeObjectURL(url), 2000);
      return;
    }
    // Fallback: hidden iframe (stays on page; browser shows download)
    triggerIframeDownload();
  }catch(_){
    triggerIframeDownload();
  }
}
function triggerIframeDownload(){
  let iframe = document.getElementById('gdrive-dl');
  if(!iframe){
    iframe = document.createElement('iframe');
    iframe.id='gdrive-dl'; iframe.style.display='none'; iframe.referrerPolicy='no-referrer';
    document.body.appendChild(iframe);
  }
  iframe.src = DRIVE_URL;
}

document.getElementById('download-apk').addEventListener('click', ()=>downloadViaFetchOrIframe());
document.getElementById('download-apk-2').addEventListener('click', ()=>downloadViaFetchOrIframe());

/* Keyboard: arrows to switch tabs */
addEventListener('keydown',(e)=>{
  if(!['ArrowLeft','ArrowRight'].includes(e.key))return;
  const order=["home","download","tg"];
  const cur = order.findIndex(t=>document.querySelector(`[data-tab="${t}"]`).getAttribute('aria-selected')==='true');
  const next = (cur + (e.key==='ArrowRight'?1:-1) + order.length) % order.length;
  setTab(order[next]);
});
</script>
</body>
</html>
